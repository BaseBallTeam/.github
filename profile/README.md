# ⚾ 머신러닝에 기반한 실시간 도루 성공 확률 예측 ⚾


## 1. 프로젝트 소개 

### 1) 프로젝트 개요
이번 프로젝트의 목적은 KBO 프로야구의 도루 성공 여부를 머신러닝 기반으로 예측하는 모델을
설계 및 평가하는 것이다.\
**XGBoost**를 주요 모델로 선택했으며, 실제 경기 데이터를 크롤링 및 가
공하여 모델 개발에 활용하였다.\
초기에 각 도루 상황(이닝, 스코어, 주력, 키/몸무게 등)의 다양한
변수를 입력 피처로 선정해 경기 맥락을 최대한 반영하려 했고, 실패/성공 탐지의 신뢰도를 높이
려 여러 보정과 피처 조합을 다르게 한 모델링 비교 분석을 하였다.\
본 분석의 차별점은 단순 점수 예측이 아닌, 선수, 경기 맥락과 물리적 특성을 폭넓게 반영하기 위해 여러 피쳐를 뒀다는 점
이고, 확률 calibration을 적용했다는 점에 있다.
 
### 2) 개발 환경 및 패키지

프로젝트는 Google Colab 기반의 클라우드 환경에서 수행하였다.\
주요 소프트웨어 및 패키지는 다음과 같다.\
특히 데이터 크롤링, 자동 파싱 및 가공 프로세스를 통해
기존 KBO기록실에는 없는 세부 변수까지 확장 수집하였다.
|     도구    |             사용처              |
| :------------------------- | :---------------------------------|
|     Python  |          사용 언어             |
|Scikit-learn | 피처 엔지니어링, 분류 및 성능 평가|
|     XGBoost |         머신러닝 모델링         |
|Pandas, Numpy, Matploblib | 데이터 가공 및 분석, 그래프 시각화|
|Google Colab, Jupyter Notebook, PyCharm | IDE |

특히 데이터 크롤링, 자동 파싱 및 가공 프로세스를 통해
기존 KBO기록실에는 없는 세부 변수까지 확장 수집하였다.

### 3) 데이터셋 구성 및 입력/출력 구조
프로젝트에 사용된 데이터셋은 2023~2025 시즌 정규 KBO 기록(주자 도루 상황별)에서 직접 크
롤링하여 만들었다. 초기엔 도루 기록이 적은 문제를 인지하여, 피처를 범주형으로 변환하는 등으
로 학습 데이터 개수를 늘렸다.
#### 입력 (Feature)
1. 이닝: 경기가 진행되는 이닝(회)
2. 스코어 상황: 도루 시점의 홈, 원정 팀 점수차
3. O 카운트: 아웃(Out) 카운트(0~2)
4. B 카운트: 볼(Ball) 카운트(0~3)
5. S 카운트: 스트라이크(Strikes) 카운트(0~2)
6. 주력: 주자의 발 빠르기(스피드, 연속형 수치)
7. 투수 손: 투수의 투구 손(오른손/왼손, 0/1로 표기)
8. 키_구간: 주자 키(Height)를 범주(10cm 단위 등)로 만든 값
9. 몸무게_구간: 주자 몸무게(Weight)를 범주형으로 변환한 값
#### 출력 (Target)
1. 도루 성공 여부 (Binary classification)
2. 예측 성공 확률 (Probability, Calibration curve 등도 해석)

데이터의 구조와 변수별 기본 통계, 변수 간 상관관계는 Pearson correlation matrix, boxplot, 샘플
별 histogram 등으로 분석하였다. 예를 들어, 주력과 키/몸무게, late-inning 여부, 투수 손은 도루
성공에 상대적으로 강한 영향력을 보여주었다.

### 4) 데이터 분석 및 피처 엔지니어링
초기 데이터 분석에서는 피처간 상관관계가 대체로 약하고, 샘플 수가 기대만큼 많지 않은 문제
가 발견됐다. 상관관계가 낮은 변수들은 노이즈 역할을 하거나, 모델의 성능을 오히려 저하시킬
수 있었다.\
피처 개선 단계에서 주력(스피드) 변수를 새롭게 추가하였다. 실제로 주력 변수 추가 전후
Pearson 상관계수 변화를 비교하면, 도루 성공과 주력의 상관성이 높아졌음이 통계적으로 확인되
었다.\
앙상블 모델에서 3가지 모델의 피처 조합은 다음과 같다.
1. 신체 피처(키/몸무게, 주력) 중심 조합
2. 경기 맥락 중심(이닝, 점수차, 볼카운트 등) 조합
3. 전체 피처 통합
상관관계가 낮은 변수 추가 시 실제 모델 평가에서 성능이 떨어지는 현상도 수치로 확인하였다.

## 2. 프로젝트 모델링 결과 

### 1) 모델링 과정 및 성능 개선
#### 1.1) 모델 설계 및 피처 조합
XGBoost Classifier를 기반으로 총 세 가지 모델을 구현하여, 피처의 정의구성과 입력 방식에 따른
예측 성능을 비교하였다.
##### 모델 1: 신체 및 주력 중심 모델
- 사용 피처: 주자의 [키], [몸무게], [주력(스피드)]을 중심으로, 신체특성과 기본 물리적 조건만을
반영하여 설계하였다.
- 주요 컬럼 그룹: height_bin, weight_bin, runner_speed, runner_speed_bin 등
- 신체 특성이 도루 성공에 미치는 영향력을 분석하였다.

##### 모델 2: 경기 맥락 중심 모델
- 사용 피처: 이닝, 점수차, O/B/S 카운트 등 경기상황 변수 중심으로 설계하였다.
- 주요 컬럼 그룹: inning, score_diff, O_count, B_count, S_count, pitcher_hand, is_late_inning,
score_bucket, BS_combo 등
- 실제 게임의 상황적 맥락에서 도루 성공률이 어떻게 변동하는지 분석하였다.

##### 모델 3: 전체 피처 통합 모델
- 사용 피처: 신체, 상황, 주력, 조합 및 구간화 된 파생변수까지 전체 변수를 통합하여 최적의 예
측 구조를 도출하였다.
- 주요 컬럼: 위 두 그룹을 모두 포함하여, 추가적으로 spd_x_inning, spd_x_score 등 비선형 및 파
생 피처, 범주형 피처 등
- 가장 많은 정보를 모델에 입력하여 설계하였다.

#### 1.2) 평가 지표와 성능 분석
세 모델 모두에 대해 train/valid/test split(비율: 2130/533/904)으로 데이터셋을 구성하고, 주요 평
가 지표는 아래와 같다.

<img width="436" height="551" alt="image" src="https://github.com/user-attachments/assets/4facabf3-11a7-4f58-a9a0-9951d10387c1" />



\
모델1은 신체 피처의 성능이 가장 안정적이나, 실패 탐지(Recall for Fail)는
전체 조합보다 떨어진다.\
모델2는 경기 상황의 노이즈, 상관관계 부족으로 ROC-AUC와 Balanced Accuracy가 가장 낮게 산
출된다.\
모델3은 모든 피처 조합을 통합해 consistently 최고 성능(특히 F1, ROC-AUC)이 나왔고, FN 탐지
력이 가장 높다.\
앙상블(Soft Voting) 결과는 각 모델 예측 확률의 가중 평균(0.5 : 신체, 0.2 : 상황, 0.3 : 전체)으로
실행했으나, 모델3 단독 성능과 비슷하거나 낮은 결과를 보여 실제 추가 성능 개선 효과는 제한
적이라고 이해 가능하다.


### 2) 확률 예측 및 Calibration
예측 확률의 신뢰도(Probability Calibration)를 향상하기 위해,
각 모델에 대해 sigmoid와 isotonic regression 두 방식으로 Calibration을 적용하였다.

<img width="615" height="513" alt="image" src="https://github.com/user-attachments/assets/987d1e6e-3b0c-4e41-9457-fed22aa84ce3" />

#### 1. Sigmoid Calibration
Platt scaling을 사용하여 예측 확률을 S자 곡선 형태로 보정하였다. Reliability Diagram에서 대각선
(이상적 신뢰도 곡선)에 가장 근접하며, bin 개수(10, 15, 20 bins) 변경 실험에서도 빠르고 안정적인
곡선을 그렸다.
#### 2. Isotonic Regression
Isotonic 방식은 구간(bin)이 많거나 데이터가 부족할 때, 예측 신뢰도 곡선이 튀거나 급격히 변동
하는 현상이 반복적으로 나타났다. 일부 데이터에서는 reliability가 실제 분포와 다르게 과대/과소
추정되는 경우도 있었다.
#### 3. 실험 그래프 및 결과 해석
실제 신뢰도 다이어그램(10/15/20 bins) 및 Calibration curve 결과, sigmoid 방식은 전체 모델에서
예측 확률이 실제 발생률과 거의 일치함을 보였다. Isotonic 방식은 일부 구간에서 큰 튀는 현상
및 불안정성을 지속적으로 보였다.

Reliability Diagram, Probability Histogram, ROC curve 등은 모델3(전체 피처 통합)이 가장 이상적
인 곡선과 높은 AUC, 분포 패턴을 그렸다.

<img width="393" height="248" alt="image" src="https://github.com/user-attachments/assets/68376b81-ab14-469d-a2c8-bc6c43aa7dab" />

### 추가 분석 - 실험적 결론 📍
  #### 1. 실패 탐지(Recall for Fail)
  모델3 > 모델1 > 모델2 순으로 탐지율, FN 감소로, 성능이 향상되었다.
  #### 2. 최적 threshold 설정
  balanced accuracy가 가장 높은 구간의 threshold(대략 0.73~0.75)를 기준으로 이진 분류 결정하고,
  각 threshold별 정확도·recall·F1-score 그래프 자동 그리기 및 최적 지점을 표기하였다.
  #### 3. Confusion matrix 시각화
  전체 모델(3번)이 FN 탐지, Precision/Recall 전반적으로 고르게 높은 값을 기록하였다.
  #### 4. Probability histogram
  전체 통합, 신체 중심, 맥락 중심 예측확률 분포 비교 시, 모델3이 가장 sharp한 분포와 실제 값
  일치를 보였다.

### 3) 모델 개선 및 피드백 대응
중간발표 이후 교수님 피드백과 자체 분석을 바탕으로,
1. 상관관계가 낮은 피처는 점진적으로 제외
2. Feature군집화로 데이터 전체 샘플 수 증가(100→400 이상)
3. 평가 지표(특히 실패 탐지, FN에 가중치 부여)를 보완
4. 모델별 threshold 설정 및 macro F1-score 중심 평가
5. 예측 확률 보정 실험 후 sigmoid방식 중심 사용 결정
   
**이 결과, 전체 피처를 활용한 모델3의 성능이 가장 우수하며,
군집화+주력변수 추가가 실질적 성능 향상에 영향을 준 것으로 판단하였다.**

### 4) 활용 가능성과 실험의 의의
본 프로젝트로 완성된 도루 성공 예측 모델은 야구 현장에서 실제로 다양한 방면으로 활용할 수
있는 잠재력을 가지고 있다.\
\
가장 직관적인 응용 예는 감독 및 벤치의 실시간 전략 보조 도구이다. 경기가 진행되는 그 즉시
현재 주자, 점수 상황, 이닝 등 데이터를 입력하면, 본 모델은 실시간으로 도루 성공률을 예측하
여 감독의 의사결정에 객관적 근거를 제공할 수 있다. 이는 기존 연구들이 단순히 성공률 평균이
나 선수 개인별 단일 통계에 의존했던 것에 비해, 훨씬 세부 상황별 맞춤화된 통합 전략 평가가
가능해진다는 점에서 실무성이 높다.\
\
방송 및 중계 분야에서도, 경기 중 '실시간 도루 성공 확률 예측 그래픽' 으로 구체적 상황정보와
예측 결과를 시청자에게 제공하면, 관람의 재미와 정보 가치가 증가한다. 데이터 보유 구단·언론
사는 시스템에 본 모델을 내장하여 다양한 후속 서비스로 개발 확장할 수 있다.\
\
이 연구는 단순한 "최다 성공 선수 선별"이 아니라, 주자 신체, 순간 스피드, 투수 특성, 점수차,
클러치 이닝, 볼/스트/아웃 카운트와 같은 경기 맥락적 피처들을 가능한 한 실제와 가깝게 반영
해 독립적인 변수와 복합 상황의 상호작용을 통계적으로 학습했다는 점에서 의미가 깊다.

### 5) 한계 및 아쉬운 점
#### (1) 포수 관련 데이터 부재
도루의 성공은 단순히 주자와 투수, 주루 타이밍만의 문제가 아니며, 포수의 송구 능력과 리드, 실
제 저지 시도 경험 등이 결정적인 변수임에도, 현 시점에서는 포수 세부 데이터를 크롤링할 수 있
는 공식 사이트 및 API가 존재하지 않아 모델에 포함하지 못했다. 만약 향후 관련 기록이 확보된
다면, 현 모델의 예측력과 실무 활용성이 더 향상될 것으로 기대된다.
#### (2) 데이터 불균형과 threshold 문제
"성공" 표본이 압도적으로 많고 "실패" 표본이 적은 현실적 데이터 불균형 문제에서 온전히 벗어
나지 못했다. 이는 곧 분류기의 threshold 설정, 실패 예측 신뢰도, FN(실패 놓침) 감소 등의 측면
에서 임계값 설정 최적화가 쉽지 않은 문제로 연결되었다.\
가중치 부여 및 평가지표(ROC-AUC, F1 등) 균형화로 보완했으나, 표본 구간에서 모델이 불안정하
게 동작하는 구간이 존재했다는 점은 인지하고 개선방향으로 남았다.
#### (3) 실시간 프로그램 완성도
원래 프로젝트 목표는 실시간 입력 데이터 바탕 도루 성공률 예측 인터페이스(응용 SW) 구현까지
였으나, 실제 시간/리소스 한계로 분석 및 모델 구축 단계에서 마무리되었다.\
그러나 데이터 구조·가공 로직, 예측 엔진, threshold 자동화 등 핵심 절차는 설계 및 검증하였기
에, 추후 완성은 개발로 이어질 수 있다고 판단하였다.
#### (4) 해설 및 분석 난이도
도루 성공률은 일부 변수(예: 주자 개개인 컨디션, 피로, 실제 의사결정 심리 등)가
수치화, 모델링 되기 어렵다는 점, 그리고 동일 조건 아래에서도 야구의 불확실성이 높다는 관점
에서 실험 결과의 해석과 실전 적용간에는 어느 정도 trade-off가 불가피하다는 것도 이번 프로젝
트에서 확인한 부분이다.



## 3. 프로젝트 실행하는 방법 

1. dev브랜치에서 remote해서 파일을 받기 (main에는 내용이 업데이트 되어 있지 않습니다.)

2.
   2-1. 구글코랩과 깃허브를 마운트해서 구글코랩으로 dev 브랜치의 코드를 불러와주세요. or
   2-2. modelingComplete.py(피처 조합을 바꾸어 3개를 모델링한 버전) 코드를 구글 코랩으로 복사 붙여넣기 해주세요.
   (둘 중 하나만 하면 됩니다)

3.
   3-1. 2-1의 방법을 쓰신 경우 data 폴더의 3개의 .csv 파일을 modelingComplete.py과 같은 경로에 넣고 실행시켜 주세요. (경로 문제)
   3-2. 2-2의 방법을 쓰신 경우 data 폴더의 3개의 .csv 파일을 구글 코랩의 현재 디렉토리에 넣고 실행시켜 주세요.
